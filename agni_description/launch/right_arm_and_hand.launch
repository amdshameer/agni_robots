<launch>
  <arg name="arm_type" default="kuka"/>
  <arg name="sim" default="true"/>
  <arg name="hand_model" default="motor"/>
  <arg name="tactile" default="ubi"/>
  <!-- upload parameters on the correct namespaces 
  must be done before gazebo spawner to have the plugin controller manager
  load on the sub namespaces -->
  
  <group ns="ra">
    <include file="$(find agni_description)/launch/arm_upload.launch" >
      <arg name="arm_type" value="$(arg arm_type)"/>
      <arg name="side" value="right"/>
      <arg name="sim" value="$(arg sim)"/>
    </include>  
  </group> 
  
  <!-- load hand description only in sim, in real, the drivers is loading it -->
  <group if="$(arg sim)" ns="rh">
    <include file="$(find agni_description)/launch/sr_upload.launch" >
      <arg name="namespace" value="rh"/>
      <arg name="side" value="right"/>
      <arg name="model" value="$(arg hand_model)"/>
      <arg name="tactile" value="$(arg tactile)"/>  
    </include>  
  </group>
  
  <!-- Load the general right robot_description, spawn it, merge joint_states -->
  <group ns="right">
    <include file="$(find agni_description)/launch/single_arm_and_hand_no_controllers.launch" >
      <!-- <arg name="init_pose" value="-x -0.5 -y 0 -z 0.05" />-->
      <arg name="namespace" value="right"/>
      <arg name="arm_type" value="$(arg arm_type)"/>
      <arg name="side" value="right"/>
      <arg name="sim" value="$(arg sim)"/>
      <arg name="hand_model" value="$(arg hand_model)"/>
      <arg name="tactile" value="$(arg tactile)"/>
    </include>
    <!-- robot_state_publisher can work with data coming from different sources at different times -->
    <node pkg="topic_tools" type="relay"
        name="$(arg arm_type)_joint_state_merger"
        args="/ra/joint_states /right/joint_states" >
    </node>
    <node pkg="topic_tools" type="relay"
        name="shadow_joint_state_merger"
        args="/rh/joint_states /right/joint_states" >
    </node>
  </group>
  
  <!-- drivers and/or controllers for the arm -->
  <group ns="ra">
    <include file="$(find agni_description)/launch/$(arg arm_type)_bringup.launch" >
      <arg name="namespace" value="ra"/>
      <arg name="sim" value="$(arg sim)"/>
    </include>  
  </group> 
   
  <!-- drivers and/or controllers for the hand -->
  <include file="$(find agni_description)/launch/sr_bringup.launch">
    <arg name="namespace" value="rh" />
    <arg name="sim" value="$(arg sim)"/>
    <arg name="side" value="right"/>
    <arg name="model" value="$(arg hand_model)"/>
    <arg name="tactile" value="$(arg tactile)"/>  
  </include>
 
</launch>
